// app.js
angular.element(document.getElementsByTagName("head")).append(angular.element('<base href="'+window.location.pathname+'" />')),angular.module("app",["ngRoute","ngDialog"]).config(["$routeProvider","$locationProvider",function(e,n){e.when("/",{templateUrl:"app/deck-root.html",controller:"WindowController"}),n.html5Mode(!0)}]),angular.module("app").constant("config",{baseUrl:-1!=window.location.hostname.indexOf("localhost")?"https://local-eam.leanix.net/demo":"",lifecycleParams:{lifecycle_data:"current",lifecycle:"any",lifecycle_op:"OR"},workspace:null,user:null}),angular.module("app").factory("ApiService",["$http","$routeParams","config",function(e,n,t){var r=function(r,a){var o="";a&&(o="?"+$.param(t.lifecycleParams)+"&"+$.param(a));var i=r+o,c=t.baseUrl+"/api/v1/"+i,s=e.get(c,{headers:{Authorization:"Bearer "+n.token}}).success(function(e){return e}).error(function(){throw"There was an error getting the response from the server."});return s};return{api:r}}]),angular.module("app").directive("providers",function(){var e=function(e){var n={},t="",r="",a=0;for(n.count=e.length,i=0;i<e.length;++i)if(e[i].resourceHasProviders){var o=e[i].resourceHasProviders.length;o>a&&(a=o,t=e[i].ID,r=e[i].displayName)}return n.maxResources=a,n.providerIDMaxResource=t,n.providerNameMaxResource=r,n},n=function(e){var n=e.getFullYear(),t="0"+(e.getMonth()+1);t=t.slice(-2,t.length-2+3);var r="0"+e.getDate();return r=r.slice(-2,r.length-2+3),r+"."+t+"."+n};return{restrict:"E",templateUrl:"app/infobox.html",replace:!0,scope:{},controller:["$scope","$element","$attrs","$routeParams","ApiService","config",function(t,r,a,o,i,c){t.imgName="providers.png",t.name="Provider",t.baseUrl=o.baseUrl;var s=new Object({relations:!0});i.api("providers",s).then(function(n){var r=e(n.data);t.keyFigure1=r.count,t.keyFigure2="-3 %",t.nameKeyFigure1="Anzahl der Provider",t.nameKeyFigure2="Vergleich zum Vormonat (der gleiche Stichtag)",t.maxResourcesLabel="Provider mit den meisten Komponenten",t.maxResources=r.maxResources,t.providerIDMaxResource=r.providerIDMaxResource,t.providerNameMaxResource=r.providerNameMaxResource;try{t.color=c.workspace.objectTypes.providers.color}catch(a){}return n}),t.date=n(new Date)}]}}),angular.module("app").directive("interfaces",function(){var e=function(e){var n={},t=0,r=0,a="",o="",c=[];for(i=0;i<e.length;++i)if(e[i].serviceHasInterfaces){var s=e[i].serviceHasInterfaces.length;t+=s,c.push(e[i].ID),s>r&&(r=s,a=e[i].ID,o=e[i].displayName)}return n.averageCount=Math.round(t/e.length),n.maxInterfaces=r,n.maxInterfacesAppID=a,n.maxInterfacesAppName=o,n.Ids=c,n},n=function(e){var n=e.getFullYear(),t="0"+(e.getMonth()+1);t=t.slice(-2,t.length-2+3);var r="0"+e.getDate();return r=r.slice(-2,r.length-2+3),r+"."+t+"."+n};return{restrict:"E",templateUrl:"app/infobox.html",replace:!0,scope:{},controller:["$scope","$element","$attrs","ApiService","$routeParams","config",function(t,r,a,o,i,c){t.imgName="interfaces.png",t.name="Schnittstellen";var s=new Object({relations:!0});o.api("services",s).then(function(n){var r=e(n.data);t.keyFigure1=r.averageCount,t.keyFigure2=r.maxInterfaces,t.nameKeyFigure1="âŒ€ Anzahl der Schnittstellen pro Applikation",t.nameKeyFigure2="Max Anzahl der Schnittstellen pro Applikation",t.maxInterfacesAppID=r.maxInterfacesAppID,t.maxInterfacesAppName=r.maxInterfacesAppName,t.baseUrl=i.baseUrl;try{t.color=c.workspace.objectTypes.services.color}catch(a){}return n}),t.date=n(new Date)}]}}),angular.module("app").directive("components",function(){var e=function(e,n){this.amount=e,this.name=n},n=function(e){var n={},t=0,r=0;for(i=0;i<e.length;++i){var a=e[i].resourceHasResourceCapabilities;e[i].factSheetHasLifecycles&&0===e[i].factSheetHasLifecycles.length&&++t,a&&0!==a.length&&a[0].supportTypeID>0&&++r}return n.count=e.length,n.noLifecycle=t,n.noSupport=e.length-r,n},t=function(e){var n={},t=e.data;for(var r in t)if(t[r].serviceHasResources&&t[r].serviceHasResources.length>0){var a=t[r].serviceHasResources;for(var o in a){var i=a[o].resourceID;n[i]="undefined"==typeof n[i]?1:n[i]+1}}return n},r=function(e){var n=0,t=0;for(var r in e)e[r]>n&&(n=e[r],t=r);return new Object({resourceID:t,occurences:n})},a=function(e){var n=e.getFullYear(),t="0"+(e.getMonth()+1);t=t.slice(-2,t.length-2+3);var r="0"+e.getDate();return r=r.slice(-2,r.length-2+3),r+"."+t+"."+n};return{restrict:"E",templateUrl:"app/infobox.html",replace:!0,scope:{},controller:["$scope","$element","$attrs","ApiService","$routeParams","config",function(o,i,c,s,l,u){o.imgName="comp.png",o.name="Komponenten",s.api("resources",{lifecycle:"any",relations:!0}).then(function(t){o.quality=[];var r=n(t.data);o.quality.push(new e(r.noLifecycle,"Anzahl der IT Komponenten ohne Lifecycle")),o.quality.push(new e(r.noSupport,"Anzahl der IT Komponenten ohne Support")),o.keyFigure1=r.count,o.nameKeyFigure1="Anzahl der IT Komponenten",o.nameKeyFigure2="Erstellte Komponenten seit Vormonat (der gleiche Stichtag)",o.date=a(new Date),o.baseUrl=l.baseUrl;try{o.color=u.workspace.objectTypes.resources.color}catch(i){}return t});var p=new Date;p.setMonth(p.getMonth()-1);var m=new Object({startDate:p.toISOString(),factSheetType:"resources",eventType:"OBJECT_CREATE",countOnly:"1"});s.api("activities",m).then(function(e){o.keyFigure2=e.data.count});var h=new Object({relations:!0});s.api("services",h).then(function(e){mostUsedComponent=r(t(e)),o.mostUsedResourceID=mostUsedComponent.resourceID,o.mostUsedComponentOccurences=mostUsedComponent.occurences,s.api("resources/"+o.mostUsedResourceID).then(function(e){o.mostUsedResourceName=e.data.displayName})})}]}}),angular.module("app").directive("applications",function(){var e=function(e,n){this.amount=e,this.name=n},n=function(e){var n={},t=0,r=0,a=0,o=0;for(i=0;i<e.length;++i)if(e[i].serviceHasInterfaces&&0===e[i].serviceHasInterfaces.length&&++t,e[i].factSheetHasDocuments&&0===e[i].factSheetHasDocuments.length&&++r,e[i].serviceHasResources&&0===e[i].serviceHasResources.length&&++a,e[i].userSubscriptions&&e[i].userSubscriptions.length){for(var c=!0,s=0;s<e[i].userSubscriptions.length;s++)"2"==e[i].userSubscriptions[s].subscriptionTypeID&&(c=!1);c&&++o}return n.count=e.length,n.noInterfaces=t,n.noDocuments=r,n.noResources=a,n.noResponsibles=o,n},t=function(e){var n=e.getFullYear(),t="0"+(e.getMonth()+1);t=t.slice(-2,t.length-2+3);var r="0"+e.getDate();return r=r.slice(-2,r.length-2+3),r+"."+t+"."+n};return{restrict:"E",templateUrl:"app/infobox.html",replace:!0,scope:{},controller:["$scope","$element","$attrs","ApiService","$routeParams","config",function(r,a,o,i,c,s){var l=new Object({relations:!0});i.api("services",l).then(function(t){r.quality=[];var a=n(t.data);r.keyFigure1=a.count,r.quality.push(new e(a.noResponsibles,"Anzahl der Applikationen ohne Verantwortlichkeiten")),r.quality.push(new e(a.noInterfaces,"Anzahl der Applikationen ohne Schnittstellen")),r.quality.push(new e(a.noDocuments,"Anzahl der Applikationen ohne Dokumente")),r.quality.push(new e(a.noResources,"Anzahl der Applikationen ohne IT Komponenten"));try{r.color=s.workspace.objectTypes.services.color}catch(o){}});var u=new Date;u.setMonth(u.getMonth()-1);var p=new Object({startDate:u.toISOString(),factSheetType:"services",eventType:"OBJECT_CREATE",countOnly:"1"});i.api("activities",p).then(function(e){r.keyFigure2=e.data.count}),r.imgName="app.png",r.name="Applikationen",r.nameKeyFigure1="Anzahl der Applikationen",r.nameKeyFigure2="Erstellte Anwendungen seit Vormonat (der gleiche Stichtag)",r.date=t(new Date),r.baseUrl=c.baseUrl}]}}),angular.module("app").config(["ngDialogProvider",function(e){e.setDefaults({className:"ngdialog-theme-default",showClose:!0,closeByDocument:!0,closeByEscape:!0})}]),angular.module("app").controller("WindowController",["$scope","$routeParams","ApiService","ngDialog","config",function(e,n,t,r,a){"token"in n&&$("body").addClass("isViewedExternally"),e.baseUrl=n.baseUrl,""===a.baseUrl&&(a.baseUrl=n.baseUrl),null===a.workspace&&t.api("config").then(function(e){a.workspace=e.data.workspace})}]);